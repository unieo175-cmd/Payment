# 支付數據分析平台 PRD（產品需求文檔）

## 1. 產品概述

### 1.1 產品名稱
支付數據分析平台（Payment Analytics Dashboard）

### 1.2 產品定位
一個基於 Web 的支付數據分析與可視化平台，用於分析充值和提現交易數據，提供多維度的統計指標、時間分佈分析和報表導出功能。

### 1.3 目標用戶
- 支付運營團隊
- 財務分析人員
- 業務管理人員

### 1.4 產品目標
- 提供即時的充值/提現數據分析
- 支持多渠道（銀行卡、支付寶、微信）數據分離查看
- 提供可視化圖表和報表導出功能
- 支持週報數據匯總
- 每個指標提供計算公式說明，方便理解數據來源

---

## 2. 功能架構

### 2.1 系統架構
```
┌─────────────────────────────────────────────────────────────┐
│                      前端應用 (Vue.js 3)                      │
├─────────────┬─────────────┬─────────────┬─────────────────────┤
│  充值分析    │  提現分析    │   週報      │   數據導出          │
├─────────────┴─────────────┴─────────────┴─────────────────────┤
│                    CSV 數據解析層                              │
├───────────────────────────────────────────────────────────────┤
│              數據源 (data.csv / withdraw.csv)                  │
└───────────────────────────────────────────────────────────────┘
```

### 2.2 技術棧
| 類別 | 技術 |
|------|------|
| 前端框架 | Vue.js 3 (Composition API) |
| 構建工具 | Vite 7 |
| 數據處理 | PapaParse |
| 報表導出 | SheetJS (xlsx) |
| 部署 | GitHub Pages |

---

## 3. 功能模組詳細說明

### 3.1 導航結構

#### 3.1.1 左側導航欄
| 導航項 | 功能說明 |
|--------|----------|
| 充值分析報表 | 查看充值相關數據和指標 |
| 提現分析報表 | 查看提現相關數據和指標 |
| 週報 | 查看週報匯總數據 |

---

### 3.2 充值分析報表

#### 3.2.1 篩選功能
| 篩選項 | 說明 |
|--------|------|
| 商戶名稱 | 可搜索的下拉選單，支持模糊搜索 |
| 日期範圍 | 開始日期 - 結束日期 |
| 查詢按鈕 | 執行篩選查詢 |
| 匯出 Excel | 導出當前篩選結果 |

#### 3.2.2 渠道切換
| 渠道 | 篩選條件 |
|------|----------|
| 全部 | 顯示所有渠道匯總數據 |
| 极速(银行卡) | 商戶含"极速充提3"且非支付寶/微信 |
| 极速(支付宝) | 商戶含"支付宝"或"支付寶" |
| 极速(微信) | 商戶含"微信" |

#### 3.2.3 全部渠道 - 重要信息
| 指標 | 計算公式 |
|------|----------|
| 總申請筆數 | 極速銀行卡+支付寶+微信 成功配對筆數 |
| 總充值成功（含掉單） | 實際收到金額 > 0 的筆數 |
| 總申請金額 | 實際收到金額 > 0 的金額加總 |
| 平均處理時間 | 實際收到金額 > 0 的處理時間平均 |
| 無效申請 | 狀態含"取消" 或 實際收到金額=0 |
| 掉單筆數 | 實際收到金額>0 且 狀態含"補" |

#### 3.2.4 全部渠道 - 處理時間分佈
| 時間區段 | 計算公式 |
|----------|----------|
| 2分鐘內 | 處理時間 <= 120秒 |
| 3-5分鐘 | 處理時間 180~300秒 |
| 5-15分鐘 | 處理時間 300~900秒 |
| 15-30分鐘 | 處理時間 900~1800秒 |
| 30分鐘以上 | 處理時間 > 1800秒 |

#### 3.2.5 全部渠道 - 充值成功時間區段（表格）
| 欄位 | 說明 | 計算公式 |
|------|------|----------|
| 總充值成功（含掉單） | 統計總數 | 實際收到金額 > 0 的筆數 +170（一般宝+70、极速提宝+100） |
| 2分鐘內 | 筆數/百分比/金額 | 處理時間 <= 120秒 |
| 2-3分鐘 | 筆數/百分比/金額 | 處理時間 120~180秒 |
| 3-5分鐘 | 筆數/百分比/金額 | 處理時間 180~300秒 |
| 5-15分鐘 | 筆數/百分比/金額 | 處理時間 300~900秒 |
| 15-30分鐘 | 筆數/百分比/金額 | 處理時間 900~1800秒 |
| 30分鐘以上 | 筆數/百分比/金額 | 處理時間 > 1800秒 |
| 无效申请 | 筆數/百分比 | 狀態含"取消" 或 實際收到金額=0 |
| 掉单 | 筆數/百分比 | 實際收到金額>0 且 狀態含"補" |
| 平均時間 | 時間 | 實際收到金額>0 的處理時間平均 |

#### 3.2.6 银行卡渠道 - 极速（银行卡）
| 區塊 | 指標 | 計算公式 |
|------|------|----------|
| 充值申請筆數 | 一般卡、极速提 | 商戶含"极速充提3" 且 不含支付寶/微信 |
| 成功配對 | 一般卡、极速提（筆數/金額） | 銀行卡代碼不為空 的筆數/申請金額 |
| 訂單成功 | 一般卡、极速提、信評上分 | 實際收到金額 > 0 的筆數/金額 |
| 沒信評降等配卡 | 按金額區間展開（100-30000元） | 無信評降等配卡的筆數，按申請金額分組統計 |

#### 3.2.7 银行卡渠道 - 其他區塊
| 區塊 | 說明 | 計算公式 |
|------|------|----------|
| c2c | 點確認、人工審核、超過11min補件後才成功 | 銀行卡代碼含"c2c" 的訂單成功筆數/金額 |
| 三方代收 | GB-DahaomenJFB、汇通、豆豆、UC聚合 | 銀行卡代碼為特定三方代收代碼 的訂單成功筆數/金額 |
| 騙分沒到賬來找 | 人工、信評、沒上傳回單重複出款充值上分 | 尚缺公式計算 |
| 商業平台 | CNX交易所充值申請/成功 | 商戶含"CNX" 的充值申請/成功筆數金額 |

#### 3.2.8 支付宝渠道 - 极速（支付宝）
| 區塊 | 指標 | 計算公式 |
|------|------|----------|
| 充值申請筆數 | 一般卡、一般寶、极速提(卡)、极速提(寶) | 商戶含"支付宝"或"支付寶" |
| 成功配對 | 一般卡、一般寶、极速提(卡)、极速提(寶) | 銀行卡代碼不為空 的筆數/申請金額 |
| 訂單成功 | 一般卡、一般寶、极速提(卡)、极速提(寶)、信評上分 | 實際收到金額 > 0 的筆數/金額 |
| 沒信評降等配卡 | 按金額區間展開 | 無信評降等配卡的筆數，按申請金額分組統計 |

#### 3.2.9 支付宝渠道 - 其他區塊
| 區塊 | 說明 | 計算公式 |
|------|------|----------|
| c2c | 同銀行卡 | 銀行卡代碼含"c2c" 的訂單成功筆數/金額 |
| 三方代收 | 同銀行卡 | 銀行卡代碼為特定三方代收代碼 的訂單成功筆數/金額 |
| 騙分沒到賬來找 | 同銀行卡 | 尚缺公式計算 |
| 寶轉卡/寶轉寶渠道 | 申請/成功筆數金額 | 尚缺公式計算 |

#### 3.2.10 微信渠道 - 极速（微信）
| 區塊 | 指標 | 計算公式 |
|------|------|----------|
| 充值申請筆數 | 一般卡、极速 | 商戶含"微信" |
| 成功配對 | 一般卡、极速（筆數/金額） | 銀行卡代碼不為空 的筆數/申請金額 |
| 訂單成功 | 一般卡、极速、信評上分 | 實際收到金額 > 0 的筆數/金額 |
| 沒信評降等配卡 | 按金額區間展開 | 無信評降等配卡的筆數，按申請金額分組統計 |

#### 3.2.11 微信渠道 - 其他區塊
| 區塊 | 說明 | 計算公式 |
|------|------|----------|
| c2c | 同銀行卡 | 銀行卡代碼含"c2c" 的訂單成功筆數/金額 |
| 三方代收 | 同銀行卡 | 銀行卡代碼為特定三方代收代碼 的訂單成功筆數/金額 |
| 騙分沒到賬來找 | 同銀行卡 | 尚缺公式計算 |

---

### 3.3 提現分析報表

#### 3.3.1 篩選功能
與充值分析相同：商戶名稱、日期範圍、查詢、匯出 Excel

#### 3.3.2 渠道切換
| 渠道 | 說明 |
|------|------|
| 全部 | 顯示所有渠道匯總數據 |
| 极速(银行卡) | remark = "银行卡" |
| 极速(支付宝) | remark = "支付宝" |
| 极速(微信) | remark = "微信" |

#### 3.3.3 全部渠道 - 提現總覽
| 指標 | 計算公式 |
|------|----------|
| 總提現成功筆數 | 實際轉出金額 (payoutAmount) > 0 的記錄數 |
| 總提現成功金額 | payoutAmount 加總 |
| 平均處理時間 | transferStatus = "轉帳完成" 的記錄平均處理時間 |
| 總提現申請筆數 | 所有記錄數（排除 test/qa 商戶） |

#### 3.3.4 全部渠道 - 提現成功時間區段（表格）
| 項目 | 說明 |
|------|------|
| 總提現成功筆數 | 統計總數 |
| 2分鐘內出款 | avgTimeSeconds < 120 |
| 2-5分鐘出款 | 120 <= avgTimeSeconds < 300 |
| 5-15分鐘出款 | 300 <= avgTimeSeconds < 900 |
| 15-30分鐘出款 | 900 <= avgTimeSeconds < 1800 |
| 超過30分鐘出款 | avgTimeSeconds >= 1800 |
| 平均時間-卡(Q) | 銀行卡渠道平均時間 |
| 平均時間-寶(R) | 支付寶渠道平均時間 |
| 提現成功率 | 提現成功筆數 / 總記錄數 |
| 提現失敗筆數 | actualAmount = 0 且 transferStatus 含"轉帳失敗" |
| 訂單成功 | transferStatus = "轉帳完成" 的記錄 |
| 訂單成功佔比 | 訂單成功 / 總記錄數 |

#### 3.3.5 平均時間計算公式
```
IF(V為空, Q - T, Q - V)

V = remainPoolCreateTime（餘額池建立時間）
Q = notifyMerchantTime（通知商戶時間）
T = requestTime（請求時間）

條件：transferStatus = "轉帳完成"
```

---

### 3.4 週報

#### 3.4.1 數據來源
同時載入充值數據 (data.csv) 和提現數據 (withdraw.csv)

#### 3.4.2 週報內容
| 區塊 | 說明 |
|------|------|
| 充值匯總 | 按渠道統計充值數據 |
| 提現匯總 | 按渠道統計提現數據 |
| 指標數據分析 | 各渠道指標匯總 |
| 下載分析範本 | Excel 範本，可貼上原始數據計算指標 |

---

### 3.5 圖表可視化

#### 3.5.1 銀行金額分佈（橫條圖）
- 顯示 Top 10 銀行的充值金額分佈
- 橘色漸層長條圖
- 滑鼠 hover 顯示完整銀行名稱和金額

#### 3.5.2 24小時交易分佈（柱狀圖）
- 按小時統計充值成功筆數和金額
- 滑鼠 hover 顯示筆數和金額詳情

---

## 4. 數據處理規則

### 4.1 數據過濾
| 過濾條件 | 說明 |
|----------|------|
| 排除商戶 | 商戶名稱包含"线下"、"test"、"qa"的記錄 |

### 4.2 銀行名稱標準化
- 移除「行動」前綴
- 簡體字轉繁體字

### 4.3 成功配對條件
| 渠道 | 條件 |
|------|------|
| 銀行卡 | 商戶含"极速充提3" 且 不含支付寶/微信 且 bankCardCode 不為空 |
| 支付寶 | 商戶含"支付宝"或"支付寶" 且 bankCardCode 不為空 |
| 微信 | 商戶含"微信" 且 bankCardCode 不為空 |

### 4.4 三方代收識別
| 代碼 | 名稱 |
|------|------|
| GB-DahaomenJFB | 大豪門 |
| HTc2cdeposit | 汇通 |
| DDFdeposit | 豆豆 |
| UC1020 | UC聚合 |
| 非 gb/auction 開頭 | 其他三方 |

---

## 5. 導出功能

### 5.1 充值報表導出
| 工作表 | 內容 |
|--------|------|
| 總覽 | 重要指標匯總 |
| 時間區段分析 | 各時間區段筆數/金額 |
| 詳細記錄 | 所有篩選後的記錄明細 |

### 5.2 提現報表導出
| 工作表 | 內容 |
|--------|------|
| 總覽 | 提現指標匯總 |
| 時間區段分析 | 各時間區段筆數/金額 |

### 5.3 指標數據分析範本
- 週報頁面可下載 Excel 範本
- 包含充值原始數據、提現原始數據、指標數據分析三個工作表
- 可貼上每日數據自動計算指標

---

## 6. UI/UX 設計規範

### 6.1 色彩規範
| 元素 | 顏色 |
|------|------|
| 主色調（Header/按鈕） | #4a4a9e（紫色） |
| 成功/表頭 | #5cb85c（綠色） |
| 背景 | #f5f7fa（淺灰） |
| 卡片背景 | #ffffff（白色） |
| 警告 | #ff9f0a（橙色） |
| 錯誤 | #ff453a（紅色） |
| 銀行金額長條圖 | #FF9800 → #FFB74D（橘色漸層） |

### 6.2 響應式設計
| 斷點 | 佈局調整 |
|------|----------|
| > 1200px | 6列網格 |
| 768px - 1200px | 2-3列網格，側邊欄收縮 |
| < 768px | 單列網格，側邊欄僅顯示圖標 |

### 6.3 交互設計
- 區塊可展開/收合
- 商戶下拉支持搜索
- Hover 時顯示詳細 Tooltip
- 數據載入顯示進度條
- 每個指標下方顯示計算公式說明

---

## 7. 部署資訊

### 7.1 專案結構
```
Projects/
├── README.md
├── 提案/
│   └── Payment/        ← 支付數據分析平台
│       ├── src/
│       ├── public/
│       ├── package.json
│       └── ...
├── 測試/
│   └── README.md
└── 正式/
    └── README.md
```

### 7.2 部署方式
GitHub Actions 自動部署到 GitHub Pages

### 7.3 部署 URL
https://unieo175-cmd.github.io/Projects/

### 7.4 觸發條件
- Push 到 main 分支
- 手動觸發 (workflow_dispatch)

---

## 8. 待完善功能

以下功能目前顯示為 0 或固定值，需要補充計算公式：

### 8.1 充值分析
| 功能 | 狀態 |
|------|------|
| 建單成功等待無配對 | 尚缺公式計算 |
| 取無卡06提示 | 尚缺公式計算 |
| 騙分拉黑 | 尚缺公式計算 |
| 卡驗及人驗 | 尚缺公式計算 |
| 騙分沒到賬來找（人工/信評） | 尚缺公式計算 |
| 寶轉卡/寶轉寶渠道統計 | 尚缺公式計算 |
| 整體配對成功/提現申請 | 尚缺公式計算 |

### 8.2 提現分析
| 功能 | 狀態 |
|------|------|
| 無卡空單率 | 尚缺公式計算 |
| 充值配對率 | 需與充值數據關聯 |
| 配對後成功率 | 需與充值數據關聯 |

---

## 9. 版本歷史

| 版本 | 日期 | 更新內容 |
|------|------|----------|
| 1.0.0 | 2026-01-27 | 初始版本，包含充值/提現分析、週報功能 |
| 1.1.0 | 2026-01-28 | 新增計算公式說明、重組專案結構、更新部署配置 |

---

## 10. 附錄

### 10.1 CSV 欄位對照表（充值）

| 欄位索引 | 欄位名稱 | 說明 |
|----------|----------|------|
| 0 | id | 流水號 |
| 2 | merchant | 商戶名稱 |
| 3 | amount | 申請金額 |
| 6 | bankCardCode | 銀行卡代碼 |
| 8 | bankName | 銀行名稱 |
| 12 | receivedAmount | 實際收到金額 (M欄) |
| 13 | status | 狀態 (N欄) |
| 16 | requestTime | 請求日期 (Q欄) |
| 19 | notifyMerchantTime | 通知商戶時間 (T欄) |
| 39 | processingTime | 處理時間 (AN欄) |

### 10.2 CSV 欄位對照表（提現）

| 欄位索引 | 欄位名稱 | 說明 |
|----------|----------|------|
| 8 | actualAmount | 實際金額 (I欄) |
| 16 | requestTime | 請求時間 (Q欄) |
| 16 | notifyMerchantTime | 通知商戶時間 (Q欄) |
| 19 | requestTime | 建立時間 (T欄) |
| 21 | remainPoolCreateTime | 餘額池建立時間 (V欄) |
| 27 | payoutAmount | 轉出金額 (AB欄) |
| 28 | transferStatus | 轉帳狀態 (AC欄) |

---

*文檔版本：1.1.0 | 最後更新：2026-01-28*
