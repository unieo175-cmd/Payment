# 支付數據分析平台 PRD（產品需求文檔）

## 1. 產品概述

### 1.1 產品名稱
支付數據分析平台（Payment Analytics Dashboard）

### 1.2 產品定位
一個基於 Web 的支付數據分析與可視化平台，用於分析充值和提現交易數據，提供多維度的統計指標、時間分佈分析和報表導出功能。

### 1.3 目標用戶
- 支付運營團隊
- 財務分析人員
- 業務管理人員

### 1.4 產品目標
- 提供即時的充值/提現數據分析
- 支持多渠道（銀行卡、支付寶、微信）數據分離查看
- 提供可視化圖表和報表導出功能
- 支持週報數據匯總

---

## 2. 功能架構

### 2.1 系統架構
```
┌─────────────────────────────────────────────────────────────┐
│                      前端應用 (Vue.js 3)                      │
├─────────────┬─────────────┬─────────────┬─────────────────────┤
│  充值分析    │  提現分析    │   週報      │   數據導出          │
├─────────────┴─────────────┴─────────────┴─────────────────────┤
│                    CSV 數據解析層                              │
├───────────────────────────────────────────────────────────────┤
│              數據源 (data.csv / withdraw.csv)                  │
└───────────────────────────────────────────────────────────────┘
```

### 2.2 技術棧
| 類別 | 技術 |
|------|------|
| 前端框架 | Vue.js 3 (Composition API) |
| 構建工具 | Vite 7 |
| 圖表庫 | Chart.js + vue-chartjs |
| 數據處理 | PapaParse |
| 報表導出 | SheetJS (xlsx) |
| 部署 | GitHub Pages |

---

## 3. 功能模組詳細說明

### 3.1 導航結構

#### 3.1.1 左側導航欄
| 導航項 | 功能說明 |
|--------|----------|
| 充值分析報表 | 查看充值相關數據和指標 |
| 提現分析報表 | 查看提現相關數據和指標 |
| 週報 | 查看週報匯總數據 |

---

### 3.2 充值分析報表

#### 3.2.1 篩選功能
| 篩選項 | 說明 |
|--------|------|
| 商戶名稱 | 可搜索的下拉選單，支持模糊搜索 |
| 日期範圍 | 開始日期 - 結束日期 |
| 查詢按鈕 | 執行篩選查詢 |
| 匯出 Excel | 導出當前篩選結果 |

#### 3.2.2 渠道切換
| 渠道 | 篩選條件 |
|------|----------|
| 全部 | 顯示所有渠道匯總數據 |
| 极速(银行卡) | 商戶含"极速充提3"且非支付寶/微信 |
| 极速(支付宝) | 商戶含"支付宝"或"支付寶" |
| 极速(微信) | 商戶含"微信" |

#### 3.2.3 全部渠道 - 重要信息
| 指標 | 計算公式 |
|------|----------|
| 總申請筆數 | 銀行卡成功配對 + 支付寶成功配對 + 微信成功配對 + 170 |
| 總充值成功（含掉單） | 所有成功配對且 receivedAmount > 0 的記錄數 |
| 總申請金額 | 充值成功筆數的金額加總 |
| 平均處理時間 | 充值成功筆數的 (通知時間 - 建立時間) 平均 |
| 無效申請 | 狀態包含"未充值"的記錄數 |
| 掉單筆數 | 充值成功 (AP > 0) 且狀態包含「補」的記錄數 |

#### 3.2.4 全部渠道 - 處理時間分佈
| 時間區段 | 說明 |
|----------|------|
| 2分鐘內 | processingTime <= 120秒 |
| 3-5分鐘 | 120秒 < processingTime <= 300秒 |
| 5-15分鐘 | 300秒 < processingTime <= 900秒 |
| 15-30分鐘 | 900秒 < processingTime <= 1800秒 |
| 30分鐘以上 | processingTime > 1800秒 |

#### 3.2.5 全部渠道 - 充值成功時間區段（表格）
| 欄位 | 說明 |
|------|------|
| 項目 | 時間區段名稱 |
| 筆數/百分比 | 該區段的筆數和佔比 |
| 金額 | 該區段的金額總計 |

#### 3.2.6 银行卡渠道 - 极速（银行卡）
| 區塊 | 指標 |
|------|------|
| 充值申請筆數 | 一般卡、极速提、建單成功等待無配對、取無卡06提示 |
| 成功配對 | 一般卡、极速提（筆數/金額） |
| 訂單成功 | 一般卡、极速提、信評上分（筆數/金額/平均時間） |
| 沒信評降等配卡 | 按金額區間展開（100-30000元） |

#### 3.2.7 银行卡渠道 - 其他區塊
| 區塊 | 說明 |
|------|------|
| c2c | 點確認、人工審核、超過11min補件後才成功、騙分拉黑、卡驗及人驗 |
| 三方代收 | GB-DahaomenJFB、汇通、豆豆、UC聚合 |
| 騙分沒到賬來找 | 人工、信評、沒上傳回單重複出款充值上分 |
| 商業平台 | CNX交易所充值申請/成功 |

#### 3.2.8 支付宝渠道 - 极速（支付宝）
| 區塊 | 指標 |
|------|------|
| 充值申請筆數 | 一般卡、一般寶、极速提(卡)、极速提(寶) |
| 成功配對 | 一般卡、一般寶、极速提(卡)、极速提(寶)（筆數/金額） |
| 訂單成功 | 一般卡、一般寶、极速提(卡)、极速提(寶)、信評上分（筆數/金額/平均時間） |
| 沒信評降等配卡 | 按金額區間展開 |

**說明：**
- 一般寶 有 +70
- 极速提宝 有 +100

#### 3.2.9 支付宝渠道 - 其他區塊
| 區塊 | 說明 |
|------|------|
| c2c | 同銀行卡 |
| 三方代收 | 同銀行卡 |
| 騙分沒到賬來找 | 同銀行卡 |
| 寶轉卡/寶轉寶渠道 | 申請/成功筆數金額、整體配對成功率 |

#### 3.2.10 微信渠道
結構與银行卡渠道類似，包含极速（微信）、c2c、三方代收、騙分沒到賬來找等區塊。

---

### 3.3 提現分析報表

#### 3.3.1 篩選功能
與充值分析相同：商戶名稱、日期範圍、查詢、匯出 Excel

#### 3.3.2 渠道切換
| 渠道 | 說明 |
|------|------|
| 全部 | 顯示所有渠道匯總數據 |
| 极速(银行卡) | remark = "银行卡" |
| 极速(支付宝) | remark = "支付宝" |
| 极速(微信) | remark = "微信" |

#### 3.3.3 全部渠道 - 提現總覽
| 指標 | 計算公式 |
|------|----------|
| 總提現成功筆數 | 實際轉出金額 (payoutAmount) > 0 的記錄數 |
| 總提現成功金額 | payoutAmount 加總 |
| 平均處理時間 | transferStatus = "轉帳完成" 的記錄平均處理時間 |
| 總提現申請筆數 | 所有記錄數（排除 test/qa 商戶） |

#### 3.3.4 全部渠道 - 提現成功時間區段（表格）
| 項目 | 說明 |
|------|------|
| 總提現成功筆數 | 統計總數 |
| 2分鐘內出款 | avgTimeSeconds < 120 |
| 2-5分鐘出款 | 120 <= avgTimeSeconds < 300 |
| 5-15分鐘出款 | 300 <= avgTimeSeconds < 900 |
| 15-30分鐘出款 | 900 <= avgTimeSeconds < 1800 |
| 超過30分鐘出款 | avgTimeSeconds >= 1800 |
| 平均時間-卡(Q) | 銀行卡渠道平均時間 |
| 平均時間-寶(R) | 支付寶渠道平均時間 |
| 提現成功率 | 提現成功筆數 / 總記錄數 |
| 提現失敗筆數 | actualAmount = 0 且 transferStatus 含"轉帳失敗" |
| 無卡空單率 | 尚缺公式計算 |
| 訂單成功 | transferStatus = "轉帳完成" 的記錄 |
| 訂單成功佔比 | 訂單成功 / 總記錄數 |

#### 3.3.5 平均時間計算公式
```
IF(V為空, Q - T, Q - V)

V = remainPoolCreateTime（餘額池建立時間）
Q = notifyMerchantTime（通知商戶時間）
T = requestTime（請求時間）

條件：transferStatus = "轉帳完成"
```

#### 3.3.6 各渠道 - 提現總覽
| 指標 | 說明 |
|------|------|
| 提現申請 | 筆數 / 金額 |
| 充值配對率 | 來自充值數據計算 |
| 充值申請 | 來自充值數據 |
| 成功配對 | 來自充值數據 |
| 配對後成功率 | 來自充值數據計算 |
| 充值成功筆數 | 來自充值數據 |
| 平均時間 | transferStatus = "轉帳完成" 的記錄平均處理時間 |

---

### 3.4 週報

#### 3.4.1 數據來源
同時載入充值數據 (data.csv) 和提現數據 (withdraw.csv)

#### 3.4.2 週報內容
| 區塊 | 說明 |
|------|------|
| 充值匯總 | 按渠道統計充值數據 |
| 提現匯總 | 按渠道統計提現數據 |
| 平均時間與騙分 | 提現平均時間（卡/寶）等指標 |

---

### 3.5 圖表可視化

#### 3.5.1 狀態分佈（圓環圖）
- 成功：到帳金額 > 0 且非補單
- 補單：狀態含補單字眼 且 到帳金額 > 0

#### 3.5.2 銀行金額分佈（橫條圖）
- 顯示 Top 8 銀行的充值金額分佈

#### 3.5.3 24小時交易分佈（柱狀圖）
- 按小時統計充值成功筆數和金額

---

## 4. 數據處理規則

### 4.1 數據過濾
| 過濾條件 | 說明 |
|----------|------|
| 排除商戶 | 商戶名稱包含"线下"、"test"、"qa"的記錄 |

### 4.2 銀行名稱標準化
- 移除「行動」前綴
- 簡體字轉繁體字

### 4.3 狀態標準化
| 原始狀態 | 標準化狀態 |
|----------|------------|
| 微信補單... | 微信补单 |
| 用户确认到帐... | 用户确认到帐 |
| 明細補單... | 明细补单 |
| 信用評分上分<br>... | 信用評分上分 |

### 4.4 成功狀態關鍵字
- 已充值
- 信用評分上分
- 回單驗證上分
- 用戶确认到账
- 银商确认到账
- 信評上分
- 自動補單
- 商戶回調上分

---

## 5. 導出功能

### 5.1 充值報表導出
| 工作表 | 內容 |
|--------|------|
| 總覽 | 重要指標匯總 |
| 時間區段分析 | 各時間區段筆數/金額 |
| 詳細記錄 | 所有篩選後的記錄明細 |

### 5.2 提現報表導出
| 工作表 | 內容 |
|--------|------|
| 總覽 | 提現指標匯總 |
| 時間區段分析 | 各時間區段筆數/金額 |

---

## 6. UI/UX 設計規範

### 6.1 色彩規範
| 元素 | 顏色 |
|------|------|
| 主色調（Header/按鈕） | #4a4a9e（紫色） |
| 成功/表頭 | #5cb85c（綠色） |
| 背景 | #f5f7fa（淺灰） |
| 卡片背景 | #ffffff（白色） |
| 警告 | #ff9f0a（橙色） |
| 錯誤 | #ff453a（紅色） |

### 6.2 響應式設計
| 斷點 | 佈局調整 |
|------|----------|
| > 1200px | 6列網格 |
| 768px - 1200px | 2-3列網格，側邊欄收縮 |
| < 768px | 單列網格，側邊欄僅顯示圖標 |

### 6.3 交互設計
- 區塊可展開/收合
- 商戶下拉支持搜索
- Hover 時顯示詳細 Tooltip
- 數據載入顯示進度條

---

## 7. 部署資訊

### 7.1 部署方式
GitHub Actions 自動部署到 GitHub Pages

### 7.2 部署 URL
https://unieo175-cmd.github.io/Payment/

### 7.3 觸發條件
- Push 到 main 分支
- 手動觸發 (workflow_dispatch)

---

## 8. 待完善功能

以下功能目前顯示為 0 或固定值，需要補充計算公式：

### 8.1 充值分析
| 功能 | 狀態 |
|------|------|
| 建單成功等待無配對 | 尚缺公式計算 |
| 取無卡06提示 | 尚缺公式計算 |
| 騙分拉黑 | 尚缺公式計算 |
| 卡驗及人驗 | 尚缺公式計算 |
| 騙分沒到賬來找（人工/信評） | 尚缺公式計算 |
| 寶轉卡/寶轉寶渠道統計 | 尚缺公式計算 |
| 整體配對成功/提現申請 | 尚缺公式計算 |

### 8.2 提現分析
| 功能 | 狀態 |
|------|------|
| 無卡空單率 | 尚缺公式計算 |
| 充值配對率 | 需與充值數據關聯 |
| 配對後成功率 | 需與充值數據關聯 |

---

## 9. 版本歷史

| 版本 | 日期 | 更新內容 |
|------|------|----------|
| 1.0.0 | 2026-01-27 | 初始版本，包含充值/提現分析、週報功能 |

---

## 10. 附錄

### 10.1 CSV 欄位對照表（充值）

| 欄位索引 | 欄位名稱 | 說明 |
|----------|----------|------|
| 0 | id | 流水號 |
| 2 | merchant | 商戶名稱 |
| 3 | amount | 申請金額 |
| 6 | bankCardCode | 銀行卡號 |
| 8 | bankName | 銀行名稱 |
| 12 | receivedAmount | 到帳金額 (AP欄) |
| 13 | status | 狀態 (N欄) |
| 16 | requestTime | 請求日期 (Q欄) |
| 19 | notifyMerchantTime | 通知商戶時間 (T欄) |
| 37 | receiptVerifyResultTime | 回單驗證結果時間 (AL欄) |

### 10.2 CSV 欄位對照表（提現）

| 欄位索引 | 欄位名稱 | 說明 |
|----------|----------|------|
| 8 | actualAmount | 實際金額 (I欄) |
| 21 | remainPoolCreateTime | 餘額池建立時間 (V欄) |
| 27 | payoutAmount | 轉出金額 (AB欄) |
| 28 | transferStatus | 轉帳狀態 (AC欄) |

---

*文檔結束*
